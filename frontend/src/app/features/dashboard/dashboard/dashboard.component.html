<!-- eslint-disable @angular-eslint/template/no-negated-async -->
<div class="dashboard-wrapper">
    <so-header class="header">
        <div class="header-dashboard">
            <so-dashboard-selection [dashboards]="(dashboards$ | async) || []" [selectedDashboard]="currentDashboard$ | async" [(creating)]="creatingNewDashboard"
                (newDashboardTitle)="createDashboard($event)" (selectDashboard)="selectDashboard($event)">
            </so-dashboard-selection>
            <button mat-flat-button color="primary" *ngIf="!creatingNewDashboard" (click)="exportDashboard()" [disabled]="!(hasCalendar$ | async)">Export Timeline</button>
        </div>
    </so-header>
    <div class="toolbar">
        <img class="logo" src="assets/logo.png"/>
        <div class="go-to-date-button">
            <input hidden [value]="currentDate" (dateChange)="goToDate($event)" [matDatepicker]="picker">
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
        </div>
    </div>
    <so-timeline 
            [date]="currentDate" 
            [scale]="timelineScale"
            [tasks]="(tasks$ | async) || []"
            (blockClicked)="displayTask($event)" 
            (scaleIncreased)="zoomIn($event)"
    >
    </so-timeline>
    <div class="zoom-buttons">
        <button mat-fab color="primary" [disabled]="timelineScale === 0" (click)="zoomIn()">
            <mat-icon>zoom_in</mat-icon>
        </button>
        <button mat-fab color="primary" [disabled]="timelineScale === 3" (click)="zoomOut()">
            <mat-icon>zoom_out</mat-icon>
        </button>
    </div>
    <button class="create-task-button" color="primary" mat-fab (click)="openCreateSidebar()">
        <mat-icon>add</mat-icon>
    </button>
    <div [ngSwitch]="sidebarType$ | async">
        <so-sidebar class="sidebar" *ngSwitchCase="SidebarType.Create" (closed)="closeSidebar()">
            <so-task-form 
                    (cancel)="closeSidebar()"
                    (submitted)="createTask($event)"
                    [hasCalendar]="(hasCalendar$ | async) ?? false"
                    [edit]="false"
            >
            </so-task-form>
        </so-sidebar>
        <so-sidebar class="sidebar" *ngSwitchCase="SidebarType.Display" (closed)="closeSidebar()">
            <so-task-info></so-task-info>
        </so-sidebar>
        <so-sidebar class="sidebar" *ngSwitchCase="SidebarType.Edit" (closed)="closeSidebar()">
            <so-task-form *ngIf="(taskToUpdate$ | async) as taskToUpdate"
                    [initialValue]="taskToUpdate" 
                    (submitted)="updateTask($event)" 
                    (cancel)="closeSidebar()" 
                    [hasCalendar]="(hasCalendar$ | async) ?? false"
                    [edit]="true"
            >
            </so-task-form>
        </so-sidebar>
    </div>
</div>