<form [formGroup]="taskForm" class="task-form-wrapper">
    <h1 i18n>Create task</h1>
    <mat-form-field class="task-field">
        <mat-label i18n>Title</mat-label>
        <input formControlName="title" matInput type="text">
        <mat-error i18n *ngIf="hasLengthErrors('title')">
            Title must be 2 to 30 characters long
        </mat-error>
    </mat-form-field>
    <mat-form-field class="task-field">
        <mat-label i18n>Description</mat-label>
        <textarea formControlName="description" matInput type="text"></textarea>
        <mat-error i18n *ngIf="hasLengthErrors('description')">
            Too long description
        </mat-error>
    </mat-form-field>
    <div class="date-row">
        <mat-form-field class="date-field" appearance="fill">
            <mat-label i18n>Start</mat-label>
            <input formControlName="startDate" matInput [matDatepicker]="startPicker" (dateChange)="validate()">
            <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
            <mat-datepicker #startPicker></mat-datepicker>
            <mat-error *ngIf="taskForm.get('startDate')?.hasError('startBeforeEnd')" i18n>
                Start must be prior to end
            </mat-error>
        </mat-form-field>
        <mat-checkbox formControlName="startTimeCheckbox" color="primary" (change)="update()" i18n>Time</mat-checkbox>
        <mat-form-field class="time-field row-end" *ngIf="selectStartTime">
            <input formControlName="startTime" matInput type="time" (change)="validate()" i18n>
        </mat-form-field>
    </div>
    <div class="date-row">
        <mat-form-field class="date-field" appearance="fill">
            <mat-label i18n>End</mat-label>
            <input formControlName="endDate" matInput [matDatepicker]="endPicker" (dateChange)="validate()">
            <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
            <mat-datepicker #endPicker></mat-datepicker>
            <mat-error i18n *ngIf="taskForm.get('endDate')?.hasError('startBeforeEnd')">
                Start must be prior to end
            </mat-error>
        </mat-form-field>
        <mat-checkbox formControlName="endTimeCheckbox" color="primary" (change)="update()" i18n>Time</mat-checkbox>
        <mat-form-field class="time-field row-end" *ngIf="selectEndTime">
            <input formControlName="endTime" matInput type="time" (change)="validate()">
        </mat-form-field>
    </div>
    <div class="date-row">
        <mat-form-field appearance="fill" class="period-field">
            <mat-label i18n>Repeating period</mat-label>
            <mat-select formControlName="repeatingPeriod" (selectionChange)="validate()">
                <mat-option *ngFor="let option of repeatingOptions" [value]="option">
                    <ng-container [ngSwitch]="option">
                        <ng-container i18n *ngSwitchCase="TaskRepeatingPeriod.None">None</ng-container>
                        <ng-container i18n *ngSwitchCase="TaskRepeatingPeriod.Day">Day</ng-container>
                        <ng-container i18n *ngSwitchCase="TaskRepeatingPeriod.Week">Week</ng-container>
                        <ng-container i18n *ngSwitchCase="TaskRepeatingPeriod.Month">Month</ng-container>
                        <ng-container i18n *ngSwitchCase="TaskRepeatingPeriod.Year">Year</ng-container>
                    </ng-container>
                </mat-option>
            </mat-select>
            <mat-error i18n *ngIf="taskForm.get('repeatingPeriod')?.hasError('shortRepeatingPeriod')">
                Repeating period must be longer than task
            </mat-error>
        </mat-form-field>
        <mat-form-field class="date-field row-end" *ngIf="isRepeating" appearance="fill">
            <mat-label i18n>End repeating</mat-label>
            <input formControlName="endRepeating" matInput [matDatepicker]="endRepeatingPicker">
            <mat-datepicker-toggle matSuffix [for]="endRepeatingPicker"></mat-datepicker-toggle>
            <mat-datepicker #endRepeatingPicker></mat-datepicker>
            <mat-error i18n *ngIf="taskForm.get('endRepeating')?.hasError('endBeforeEndRepeating')">
                Repeating end must be after task end
            </mat-error>
        </mat-form-field>
    </div>
    <div class="button-row">
        <button i18n mat-flat-button class="cancel-button" (click)="closeForm()">Cancel</button>
        <button i18n mat-flat-button class="save-button" color="primary" [disabled]="!taskForm.valid" (click)="createTask()">Save</button>
    </div>
</form>